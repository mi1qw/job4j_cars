<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}"
      lang="en">
<head>
  <title>Редактировать</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  <link rel='stylesheet'
        href='https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css'>

  <link rel='stylesheet' th:href="@{/css/draganddrop.css}">
</head>
<body>

<th:block layout:fragment="breadcrumb">
  <nav layout:replace="~{layout/breadcrumbs::breadcrumb('редактировать')}">
    <th:block layout:fragment="prev-breadcrumb">
      <li class="breadcrumb-item">
        <a class="bread-link" th:href="@{/myposts}">мои объявления</a>
      </li>
    </th:block>
  </nav>
</th:block>

<div layout:fragment="page-content">
  <div th:replace="~{fragments/defssvg::difssvg}"></div>
  <div class="container mt-5">
    <div class="numbering fw-bolder">1</div>
    <div class="fw-bolder ps-5">Основная информация</div>
    <div th:each="state:${@userSession.getCarState().getStepList()}"
         class="ps-5">
      <div th:switch="*{state.step}">
        <div th:case="0" th:insert="~{fragments/stepaddingcar::stepMark(*{state})}"></div>
        <div th:case="1" th:insert="~{fragments/stepaddingcar::stepModel(*{state})}"></div>
        <div th:case="2" th:insert="~{fragments/stepaddingcar::stepYear(*{state})}"></div>
        <div th:case="3" th:insert="~{fragments/stepaddingcar::stepBody(*{state})}"></div>
        <div th:case="4" th:insert="~{fragments/stepaddingcar::stepGen(*{state})}"></div>
        <div th:case="5" th:insert="~{fragments/stepaddingcar::stepEngine(*{state})}"></div>
        <div th:case="6" th:insert="~{fragments/stepaddingcar::stepTransm(*{state})}"></div>
        <div th:case="7" th:insert="~{fragments/stepaddingcar::stepGear(*{state})}"></div>
        <div th:case="8" th:insert="~{fragments/stepaddingcar::stepModif(*{state})}"></div>
        <div th:case="9" th:insert="~{fragments/stepaddingcar::stepColor(*{state})}"></div>
      </div>
    </div>

    <div th:if="${@userSession.getCarState().isDone()}">
      <form th:action="@{/cars/add}" th:object="${carform}" method="post" id="carform"
            class="pt-4">

        <div th:each="optDto:${@userSession.getCarState().optionsDto}">
          <div th:text="${optDto.getKey()}" class="mt-3 mb-1"></div>
          <th:block th:each="optIsRest:${optDto.getValue().get(false)}">
            <th:block th:each="opt:${optIsRest.getValue()}">
              <div
                  th:replace="~{fragments/stepaddingcar::options(${opt},${opt.isOn()}, true)}"></div>
            </th:block>
          </th:block>

          <th:block th:each="optIsRest:${optDto.getValue().get(true)}">
            <th:block th:each="opt:${optIsRest.getValue()}">
              <div
                  th:replace="~{fragments/stepaddingcar::options(${opt},${opt.isOn()}, false)}"></div>
            </th:block>
          </th:block>
        </div>

        <div class="pt-5">
          <div class="numbering fw-bolder">2</div>
          <div class="fw-bolder ps-5">Добавить фотографии</div>

          <!--    <p>Upload multiple files with the file dialog or by dragging and dropping images onto the-->
          <!--      dashed region</p>-->
          <div id="drop-area" class="ms-5">
            <div id="emptyArea">
              <div class="d-flex justify-content-center"
                   style="height: 220px;cursor: pointer;">
                <div class="PhotosAdd__title">
                  <div class="PhotosAdd__icon">
                    <svg class="IconSvg IconSvg_photo IconSvg_size_32">
                      <use xlink:href="#photo"></use>
                    </svg>
                  </div>
                  <div class="PhotosAdd">Выберите или перетащите несколько фото</div>
                </div>
              </div>
            </div>

            <form class="my-form" id="my-form">
              <input style="display: none;"
                     type="file" id="fileElem" multiple accept="image/*"
                     form="my-form"
                     onchange="handleFiles(this.files)">
              <!--        <label class="button" for="fileElem">перетащите несколько фото</label>-->
            </form>
            <progress class="display-none" id="progress-bar" max=100 value=0></progress>
            <div id="gallery">
              <div th:each="img:${@userSession.getNewCar().getImages()}"
                   th:attr="data-img=${img}"
                   class="MdsPhoto MdsPhotos__item">
                <div>
                  <a href="javascript:void(0)"
                     th:onclick="aClick(this)">
                    <svg
                        class="IconSvg IconSvg_trash IconSvg_size_24 MdsPhoto__icon MdsPhoto__icon_right">
                      <use xlink:href="#trash"></use>
                    </svg>
                  </a>
                </div>
                <img th:src="@{|/cars/img/${img}|}">
              </div>
            </div>
          </div>
          <div class="text-danger"
               th:if="${#fields.hasErrors('images')}"
               th:text="${#strings.listJoin(#fields.errors('images'),', ')}"></div>
        </div>

        <div class="pt-4" style="max-width: 600px">
          <div class="numbering fw-bolder">3</div>
          <div class="fw-bolder ps-5">Описание</div>

          <div class="ms-5 pt-3">
            <input th:field="*{images}" hidden form="carform">

            <div class="form-floating mb-3" style="width: 9em">
              <input type="number" min="1" class="form-control" id="odometer" placeholder="km"
                     form="carform"
                     th:classappend="${#fields.hasErrors('odometer')} ? ' is-invalid'"
                     th:field="*{odometer}">
              <div class="text-danger"
                   th:if="${#fields.hasErrors('odometer')}"
                   th:text="${#strings.listJoin(#fields.errors('odometer'),', ')}"></div>
              <label for="odometer">Пробег тыс. км.</label>
            </div>

            <label class="small-label mt-2" for="yearPurchase">год покупки</label>
            <select class="form-select" aria-label="Default select example"
                    id="yearPurchase" style="width: 8.7em"
                    th:field="*{yearPurchase}" form="carform">
            </select>

            <div
                th:replace="~{fragments/validInput::selectfield(labelText='Город',fieldName='city',fieldID= *{city?.id}, formId='carform')}"></div>

            <div class="pt-4">
              <div class="form-floating">
                <textarea th:field="*{description}" form="carform"
                          class="form-control" placeholder="Leave a comment here"
                          id="floatingTextarea2"
                          style="height: 100px"></textarea>
                <label for="floatingTextarea2">Описание</label>
              </div>
            </div>

            <div class="pt-4">
              <div class="form-floating" style="width: 8em">
                <input type="number" class="form-control" id="price" placeholder="0" form="carform"
                       th:classappend="${#fields.hasErrors('price')} ? ' is-invalid'"
                       th:field="*{price}">
                <div class="text-danger"
                     th:if="${#fields.hasErrors('price')}"
                     th:text="${#strings.listJoin(#fields.errors('price'),', ')}"></div>
                <label for="price">Цена</label>
              </div>
            </div>

            <div class="d-flex pt-3 pb-5">
              <div class="pe-3">
                <button type="submit" class="btn btn-light btn-block py-1"
                        form="carform">Save
                </button>
              </div>
              <div>
                <a th:href="@{/myposts}" class="btn btn-light py-1">Cancel</a>
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>


<th:block layout:fragment="page-scripts">
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
  <script th:src="@{/js/draganddrop.js}"></script>
  <script>
      var e = document.getElementById("select-models");

      function onChange() {
          var value = e.value;
          var text = e.options[e.selectedIndex].text;
          console.log(value, text);

          window.location.href = '/cars/addState?stateID=1&id=' + value;
      }

      e.onchange = onChange;
  </script>
</th:block>
</body>
</html>
